Description: Core project rules for Tribal Knowledge Deep Agent
Globs: **/*.ts

# Tribal Knowledge Deep Agent - Core Rules

## Architecture Principles

1. **Planner Handles Table Iteration**: The Schema Analyzer (Planner) iterates through all tables and extracts complete metadata upfront. The Documenter spawns sub-agents based on plan entries, not by iterating tables itself.

2. **MCP in Separate Repo**: MCP tools are implemented in another repository. This repo provides retrieval functions that the external MCP calls.

3. **Sub-agent Pattern**: Use TableDocumenter and ColumnInferencer sub-agents for repeated tasks. Sub-agents practice context quarantine - they return summaries, not raw data.

4. **Manual Triggers**: All phases are user-triggered (no autonomous execution).

## Code Organization

- `src/planner/`: Schema Analyzer that extracts all metadata
- `src/agents/documenter/`: Spawns sub-agents based on plan
- `src/agents/indexer/`: Builds search index
- `src/agents/retrieval/`: Functions called by external MCP
- `src/connectors/`: Database connectors (PostgreSQL, Snowflake)
- `src/search/`: Hybrid search implementation

## Key Patterns

- Planner extracts metadata → Plan contains complete metadata
- Documenter receives plan → Spawns sub-agents with metadata from plan
- Sub-agents sample data and generate docs → Return summaries only
- Indexer reads docs → Builds search index
- Retrieval functions → Called by external MCP
